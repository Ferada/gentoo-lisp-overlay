Author: Stelian Ionescu <sionescu@common-lisp.net>
Date: 2008-01-18
Status: Pending
Description: Fixes compiling SWANK with ECL

diff --git a/swank-ecl.lisp b/swank-ecl.lisp
index 6d3786f..c6ddbd5 100644
--- a/swank-ecl.lisp
+++ b/swank-ecl.lisp
@@ -12,6 +12,7 @@
 
 (defvar *tmp*)
 
+(eval-when (:compile-toplevel)
 (if (find-package :gray)
   (import-from :gray *gray-stream-symbols* :swank-backend)
   (import-from :ext *gray-stream-symbols* :swank-backend))
@@ -21,12 +22,13 @@
    :eql-specializer-object
    :generic-function-declarations
    :specializer-direct-methods
-   :compute-applicable-methods-using-classes))
+   :compute-applicable-methods-using-classes)))
 
 
 ;;;; TCP Server
 
-(require 'sockets)
+(eval-when (:compile-toplevel :load-toplevel :execute)
+  (require 'sockets))
 
 (defun resolve-hostname (name)
   (car (sb-bsd-sockets:host-ent-addresses
@@ -206,23 +208,24 @@
 
 ;;; Debugging
 
-(import
- '(si::*break-env*
-   si::*ihs-top*
-   si::*ihs-current*
-   si::*ihs-base*
-   si::*frs-base*
-   si::*frs-top*
-   si::*tpl-commands*
-   si::*tpl-level*
-   si::frs-top
-   si::ihs-top
-   si::ihs-fun
-   si::ihs-env
-   si::sch-frs-base
-   si::set-break-env
-   si::set-current-ihs
-   si::tpl-commands))
+(eval-when (:compile-toplevel)
+  (import
+   '(si::*break-env*
+     si::*ihs-top*
+     si::*ihs-current*
+     si::*ihs-base*
+     si::*frs-base*
+     si::*frs-top*
+     si::*tpl-commands*
+     si::*tpl-level*
+     si::frs-top
+     si::ihs-top
+     si::ihs-fun
+     si::ihs-env
+     si::sch-frs-base
+     si::set-break-env
+     si::set-current-ihs
+     si::tpl-commands)))
 
 (defvar *backtrace* '())
 
