--- last/chicken-2.732/rules.make	2007-11-02 03:00:15.000000000 +0000
+++ chicken-2.732/rules.make	2007-11-04 18:01:06.000000000 +0000
@@ -638,7 +638,8 @@
 
 # program objects
 
-chicken-profile$(O): chicken-profile.c chicken.h $(CHICKEN_CONFIG_H) libchicken$(SO)
+chicken-profile$(O): chicken-profile.c chicken.h $(CHICKEN_CONFIG_H) \
+	libchicken$(SO)$(SO_MAIN_VERSION)$(SO_SECONDARY_VERSION)
 	$(C_COMPILER) $(C_COMPILER_OPTIONS) $(C_COMPILER_PTABLES_OPTIONS) $(INCLUDES) \
 	  $(C_COMPILER_COMPILE_OPTION) $(C_COMPILER_OPTIMIZATION_OPTIONS) $< $(C_COMPILER_OUTPUT_OPTION) $@
 chicken-setup$(O): chicken-setup.c chicken.h $(CHICKEN_CONFIG_H)
@@ -662,12 +663,20 @@
 
 # libchicken
 
-libchicken$(SO): $(LIBCHICKEN_SHARED_OBJECTS) $(PCRE_SHARED_OBJECTS) $(APPLY_HACK_OBJECT)
-	$(LINKER) $(LINKER_LINK_SHARED_LIBRARY_OPTIONS) $(LIBCHICKEN_SO_LINKER_OPTIONS) \
+libchicken$(SO)$(SO_MAIN_VERSION)$(SO_SECONDARY_VERSION): $(LIBCHICKEN_SHARED_OBJECTS) \
+	$(PCRE_SHARED_OBJECTS) $(APPLY_HACK_OBJECT)
+	$(LINKER) $(LINKER_LINK_SHARED_LIBRARY_OPTIONS) \
+	$(LINKER_SONAME_VERSIONING_OPTIONS)\
+	libchicken$(SO)$(SO_MAIN_VERSION) \
+	$(LIBCHICKEN_SO_LINKER_OPTIONS) \
 	  $(LINKER_OUTPUT_OPTION) $@ $^ $(LIBCHICKEN_SO_LIBRARIES)
 
-libuchicken$(SO): $(LIBUCHICKEN_SHARED_OBJECTS) $(PCRE_SHARED_OBJECTS) $(APPLY_HACK_OBJECT)
-	$(LINKER) $(LINKER_LINK_SHARED_LIBRARY_OPTIONS) $(LIBUCHICKEN_SO_LINKER_OPTIONS) \
+libuchicken$(SO)$(SO_MAIN_VERSION)$(SO_SECONDARY_VERSION): $(LIBUCHICKEN_SHARED_OBJECTS) \
+	$(PCRE_SHARED_OBJECTS) $(APPLY_HACK_OBJECT)
+	$(LINKER) $(LINKER_LINK_SHARED_LIBRARY_OPTIONS) \
+	$(LINKER_SONAME_VERSIONING_OPTIONS)\
+	libuchicken$(SO)$(SO_MAIN_VERSION) \
+	$(LIBUCHICKEN_SO_LINKER_OPTIONS) \
 	  $(LINKER_OUTPUT_OPTION) $@ $^ $(LIBUCHICKEN_SO_LIBRARIES)
 
 libchickengui$(SO): $(LIBCHICKENGUI_SHARED_OBJECTS) $(PCRE_SHARED_OBJECTS) $(APPLY_HACK_OBJECT)
@@ -737,8 +746,9 @@
 	  $(LIBDIR)/libuchicken$(A)
 	$(INSTALL_PROGRAM) $(INSTALL_PROGRAM_FILE_OPTIONS) chicken.h $(CHICKEN_CONFIG_H) $(INCDIR)
 ifndef STATICBUILD
-	$(INSTALL_PROGRAM) $(INSTALL_PROGRAM_SHARED_LIBRARY_OPTIONS) libchicken$(SO) \
-	  libuchicken$(SO) $(LIBDIR)
+	$(INSTALL_PROGRAM) $(INSTALL_PROGRAM_SHARED_LIBRARY_OPTIONS) \
+	libchicken$(SO)$(SO_MAIN_VERSION)$(SO_SECONDARY_VERSION) \
+	  libuchicken$(SO)$(SO_MAIN_VERSION)$(SO_SECONDARY_VERSION) $(LIBDIR)
 ifdef WINDOWS
 	$(INSTALL_PROGRAM) $(INSTALL_PROGRAM_SHARED_LIBRARY_OPTIONS) libchickengui$(SO) \
 	  $(LIBDIR)
@@ -920,7 +930,8 @@
 	-$(REMOVE_COMMAND) $(REMOVE_COMMAND_OPTIONS) chicken$(EXE) csi$(EXE) csc$(EXE) \
 	  chicken-setup$(EXE) chicken-profile$(EXE) csi-static$(EXE) \
 	  csc-static$(EXE) chicken-static$(EXE) chicken-bug$(EXE) chicken.info *$(O) \
-	  libchicken$(SO) libuchicken$(SO) libchicken$(A) libuchicken$(A) \
+	  libchicken$(SO)$(SO_MAIN_VERSION)$(SO_SECONDARY_VERSION) \
+	  libuchicken$(SO)$(SO_MAIN_VERSION)$(SO_SECONDARY_VERSION) libchicken$(A) libuchicken$(A) \
 	  chicken.info $(CLEAN_PCRE) $(CLEAN_MINGW_LIBS)
 
 confclean:
