--- stumpwm-0.9.5.orig/stumpwm.asd	2008-10-21 23:07:48.000000000 +0200
+++ stumpwm-0.9.5/stumpwm.asd	2008-12-04 01:49:43.000000000 +0100
@@ -7,13 +7,9 @@
 ;; This is a hack for debian because it calls cmucl's clx
 ;; cmucl-clx. *very* annoying. I don't actually know if debian still
 ;; does this.
-#+cmu (progn
-	  (ignore-errors (require :cmucl-clx))
-	  (ignore-errors (require :clx)))
-;; Otherwise just load clx
-#+sbcl(require :clx)
-
-#+sbcl (require :sb-posix)
+#+cmu
+(eval-when (:compile-toplevel :load-toplevel :execute)
+  (require :clx))
 
 (defsystem :stumpwm
   :name "StumpWM"
@@ -23,7 +19,7 @@
   ;; :license "GNU General Public License"
   :description "A tiling, keyboard driven window manager" 
   :serial t
-  :depends-on (:cl-ppcre)
+  :depends-on (:cl-ppcre #+sbcl :sb-posix #-(or cmu clisp) :clx)
   :components ((:file "package")
 	       (:file "primitives")
                (:file "workarounds")
